# Gemini & Veo Watermark Remover

[![License](https://img.shields.io/badge/license-MIT-orange?style=flat-square)](LICENSE)
[![Python](https://img.shields.io/badge/python-3.10+-blue?style=flat-square)](https://python.org)

A Python CLI tool for removing watermarks from images and videos generated by Google Gemini AI and Veo. Uses **Reverse Alpha Blending** for Gemini and **ffmpeg delogo** for Veo watermarks.

## Installation

Requires Python 3.10+ and [uv](https://docs.astral.sh/uv/):

```bash
# Install with uv
uv sync

# Or install with pip
pip install .
```

**Note:** Video processing requires [ffmpeg](https://ffmpeg.org/) to be installed and in your PATH.

## Usage

```bash
# Process a single image (Gemini)
gwr process image.png

# Process a single video (Gemini)
gwr process video.mp4 -o output.mp4

# Process a Veo video (uses --veo flag)
gwr process video.mp4 --veo

# Batch process a directory
gwr process ./photos/

# Batch process recursively with custom suffix
gwr process ./media/ -r --suffix "_clean"

# Show supported formats
gwr info
```

### Options

| Option | Description |
|--------|-------------|
| `-o, --output` | Output path (file or directory) |
| `-r, --recursive` | Process directories recursively |
| `-s, --suffix` | Suffix for output files (default: `_cleaned`) |
| `-y, --overwrite` | Overwrite existing files without prompting |
| `--veo` | Remove Veo watermark instead of Gemini (videos only) |

### Supported Formats

**Images:** PNG, JPG, JPEG, WebP, BMP, TIFF
**Videos:** MP4, WebM, MOV, AVI, MKV
**Video Output:** MP4 (H.264)

## How It Works

### Gemini Watermark Removal

Gemini adds watermarks using standard **Alpha Compositing**. This tool reverses that math:

**The Watermark Formula:**
$$Pixel_{final} = (\alpha \times Pixel_{logo}) + (1 - \alpha) \times Pixel_{original}$$

**The Solution (Reverse Engineering):**
$$Pixel_{original} = \frac{Pixel_{final} - (\alpha \times Pixel_{logo})}{1 - \alpha}$$

The tool uses pre-extracted alpha maps (`bg_48.png`, `bg_96.png`) containing the watermark's transparency values, enabling pixel-perfect restoration.

**Watermark Detection:**
- **48px watermark** (32px margin): Images ≤1024px in both dimensions
- **96px watermark** (64px margin): Images >1024px in either dimension

### Veo Watermark Removal

Veo videos have a small "Veo" text watermark in the bottom-right corner. This tool uses ffmpeg's **delogo filter** which performs spatial interpolation to remove the watermark region.

**Advantages:**
- Much faster than frame-by-frame processing (no frame extraction)
- Single ffmpeg pass with native filter chain
- Preserves audio without re-encoding issues

**Note:** The delogo filter uses surrounding pixels to fill in the watermark area, which may produce slight artifacts on complex backgrounds.

## Project Structure

```
gemini-watermark-remover/
├── pyproject.toml
├── src/gemini_watermark_remover/
│   ├── cli.py              # CLI interface (typer)
│   ├── core/
│   │   ├── alpha_map.py    # Alpha extraction from reference PNGs
│   │   ├── blend.py        # Reverse alpha blending algorithm
│   │   └── position.py     # Watermark position calculation
│   ├── processors/
│   │   ├── image.py        # Image processing (Pillow)
│   │   └── video.py        # Video processing (ffmpeg)
│   └── assets/
│       ├── bg_48.png       # Alpha map for small images
│       └── bg_96.png       # Alpha map for large images
└── assets/                  # Original reference files
```

## Disclaimer

This tool is for **educational and personal use only**.

- It only removes visible watermarks; it **does not** remove invisible SynthID watermarks embedded by Google.
- Please respect Google's Terms of Service and Intellectual Property rights.

## Credits

- Algorithm adapted from [GeminiWatermarkTool](https://github.com/allenk/GeminiWatermarkTool) and [journey-ad](https://github.com/journey-ad/gemini-watermark-remover).
