# AI Watermark Remover

[![License](https://img.shields.io/badge/license-MIT-orange?style=flat-square)](LICENSE)
[![Python](https://img.shields.io/badge/python-3.10+-blue?style=flat-square)](https://python.org)

A Python CLI tool for removing watermarks from images and videos generated by Google AI (Gemini and Veo). Automatically removes **all** watermarks in a single pass.

## Installation

Requires Python 3.10+ and [uv](https://docs.astral.sh/uv/):

```bash
# Install with uv
uv sync

# Or install with pip
pip install .
```

**Note:** Video processing requires [ffmpeg](https://ffmpeg.org/) to be installed and in your PATH.

## Usage

```bash
# Process a single image
gwr process image.png

# Process a single video (removes both Gemini + Veo watermarks)
gwr process video.mp4 -o output.mp4

# Batch process a directory
gwr process ./photos/

# Batch process recursively with custom suffix
gwr process ./media/ -r --suffix "_clean"

# Show supported formats
gwr info
```

### Options

| Option | Description |
|--------|-------------|
| `-o, --output` | Output path (file or directory) |
| `-r, --recursive` | Process directories recursively |
| `-s, --suffix` | Suffix for output files (default: `_cleaned`) |
| `-y, --overwrite` | Overwrite existing files without prompting |

### Supported Formats

**Images:** PNG, JPG, JPEG, WebP, BMP, TIFF
**Videos:** MP4, WebM, MOV, AVI, MKV
**Video Output:** MP4 (H.264)

## How It Works

For videos, both watermarks are removed in a single processing pass:

1. **Extract frames** from input video
2. **Remove Gemini watermark** from each frame (alpha blending reversal)
3. **Reassemble video** with ffmpeg, applying **Veo delogo filter** during encoding
4. **Preserve audio** from original

### Gemini Watermark (Alpha Blending)

$$Pixel_{original} = \frac{Pixel_{final} - (\alpha \times 255)}{1 - \alpha}$$

Uses pre-extracted alpha maps (`bg_48.png`, `bg_96.png`) for pixel-perfect restoration.

**Watermark Detection:**
- **48px** (32px margin): Images/videos ≤1024px
- **96px** (64px margin): Images/videos >1024px

### Veo Watermark (Delogo Filter)

Small "Veo" text in bottom-right corner. Uses ffmpeg's `delogo` filter with spatial interpolation to fill the watermark region from surrounding pixels.

## Project Structure

```
gemini-watermark-remover/
├── pyproject.toml
├── src/gemini_watermark_remover/
│   ├── cli.py              # CLI interface (typer)
│   ├── core/
│   │   ├── alpha_map.py    # Alpha extraction from reference PNGs
│   │   ├── blend.py        # Reverse alpha blending algorithm
│   │   └── position.py     # Watermark position calculation
│   ├── processors/
│   │   ├── image.py        # Image processing (Pillow)
│   │   └── video.py        # Video processing (ffmpeg)
│   └── assets/
│       ├── bg_48.png       # Alpha map for small images
│       └── bg_96.png       # Alpha map for large images
└── assets/                  # Original reference files
```

## Disclaimer

This tool is for **educational and personal use only**.

- It only removes visible watermarks; it **does not** remove invisible SynthID watermarks embedded by Google.
- Please respect Google's Terms of Service and Intellectual Property rights.

## Credits

- Algorithm adapted from [GeminiWatermarkTool](https://github.com/allenk/GeminiWatermarkTool) and [journey-ad](https://github.com/journey-ad/gemini-watermark-remover).
